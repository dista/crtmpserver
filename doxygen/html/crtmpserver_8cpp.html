<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>crtmpserver: branches/1.0/sources/crtmpserver/src/crtmpserver.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">crtmpserver</div>
   <div id="projectbrief">AmediaserverforAdobe®Flash®,Apple®iOSdevicesandblahblah.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>branches/1.0/sources/crtmpserver/src/crtmpserver.cpp File Reference</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;netio/netio.h&quot;</code><br/>
<code>#include &quot;configuration/configfile.h&quot;</code><br/>
<code>#include &quot;protocols/protocolmanager.h&quot;</code><br/>
<code>#include &quot;application/clientapplicationmanager.h&quot;</code><br/>
<code>#include &quot;protocols/protocolfactorymanager.h&quot;</code><br/>
<code>#include &quot;protocols/defaultprotocolfactory.h&quot;</code><br/>
</div>
<p><a href="crtmpserver_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structRunningStatus.html">RunningStatus</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#ae9399b6107bb1108bb8506c78341326d">RTMPSERVER_VERSION</a>&#160;&#160;&#160;&quot;(version not available)&quot;</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a80d68e031b0e7016556e529e1b63fa5e">QuitSignalHandler</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a248c764067ee60c03ee370784c49f353">Initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#aa3eca255b6be227d7d901cc2a72017a5">Run</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#ae89a123aad1c66a76c398b7af216aae4">Cleanup</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#ae964ff8411b4fdcaf65cb5529aea4bef">PrintHelp</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a1fae5968f70747445d63f63065fb7ef3">PrintVersion</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a47d3f62cf74aef3f51774a4fe59063ae">NormalizeCommandLine</a> (string configFile)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#adedd5b79ceb3bb26176b45c97b9653fb">ApplyUIDGID</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a1641a04a6e7e7520ab661fda41f9df30">WritePidFile</a> (pid_t pid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRunningStatus.html">RunningStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ae9399b6107bb1108bb8506c78341326d"></a><!-- doxytag: member="crtmpserver.cpp::RTMPSERVER_VERSION" ref="ae9399b6107bb1108bb8506c78341326d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RTMPSERVER_VERSION&#160;&#160;&#160;&quot;(version not available)&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adedd5b79ceb3bb26176b45c97b9653fb"></a><!-- doxytag: member="crtmpserver.cpp::ApplyUIDGID" ref="adedd5b79ceb3bb26176b45c97b9653fb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ApplyUIDGID </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00351">351</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                   {
<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ((uint32_t) <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--gid&quot;</span>] != 0) {
                <span class="keywordflow">if</span> (setgid((uid_t) <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--gid&quot;</span>]) != 0) {
                        <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to set GID&quot;</span>);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
        }
        <span class="keywordflow">if</span> ((uint32_t) <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--uid&quot;</span>] != 0) {
                <span class="keywordflow">if</span> (setuid((uid_t) <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--uid&quot;</span>]) != 0) {
                        <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to set UID&quot;</span>);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae89a123aad1c66a76c398b7af216aae4"></a><!-- doxytag: member="crtmpserver.cpp::Cleanup" ref="ae89a123aad1c66a76c398b7af216aae4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Cleanup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00265">265</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">               {
        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Shutting down protocols manager&quot;</span>);
        <a class="code" href="classProtocolManager.html#a0992090e52f72e3a94a39cec8790fa61" title="This function deletes all active protocols.">ProtocolManager::Shutdown</a>();
        <a class="code" href="classProtocolManager.html#aaf6c48b424b8f4a43bdee8c8e7fdb6a5" title="This function makes sure that the memory allocated to all dead protocols are deleted.">ProtocolManager::CleanupDeadProtocols</a>();

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Shutting down I/O handlers manager&quot;</span>);
        IOHandlerManager::ShutdownIOHandlers();
        IOHandlerManager::DeleteDeadHandlers();
        IOHandlerManager::Shutdown();

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Unregister and delete default protocol handler&quot;</span>);
        <a class="code" href="classProtocolFactoryManager.html#ad2597f4c7c201eebd0505f78e01ae092" title="Erases the atomic protocols and protocol chains of the factory.">ProtocolFactoryManager::UnRegisterProtocolFactory</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a5b51914db7d5f184a2c602510cd5dcd1">pProtocolFactory</a>);
        <span class="keyword">delete</span> <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a5b51914db7d5f184a2c602510cd5dcd1">pProtocolFactory</a>;
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a5b51914db7d5f184a2c602510cd5dcd1">pProtocolFactory</a> = NULL;

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Shutting down applications&quot;</span>);
        <a class="code" href="classClientApplicationManager.html#ac0a626d3bb909afc604f7e006b4d1325" title="Deletes applications registered to the base client application.">ClientApplicationManager::Shutdown</a>();

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Delete the configuration&quot;</span>);
        <span class="keyword">delete</span> <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>;
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a> = NULL;

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Doing final OpenSSL cleanup&quot;</span>);
        <a class="code" href="crypto_8h.html#a6ada467df851501450fd99d46dcbd8c4">CleanupSSL</a>();

        <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Shutting down the logger leaving you in the dark. Bye bye... :(&quot;</span>);
        <a class="code" href="classLogger.html#af2a1ebbeb0f6aac6dac07e9f23955d7e">Logger::Free</a>(<span class="keyword">true</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a248c764067ee60c03ee370784c49f353"></a><!-- doxytag: member="crtmpserver.cpp::Initialize" ref="a248c764067ee60c03ee370784c49f353" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Initialize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00119">119</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                  {
        <a class="code" href="classLogger.html#a42c282f4c0e2c6557d16e2967c1ddf7e">Logger::Init</a>();

        <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--use-implicit-console-appender&quot;</span>]) {
                <a class="code" href="classVariant.html">Variant</a> dummy;
                dummy[<a class="code" href="defines_8h.html#a497e98d5fb3cd01c189fe668777bdc1a">CONF_LOG_APPENDER_NAME</a>] = <span class="stringliteral">&quot;implicit console appender&quot;</span>;
                dummy[<a class="code" href="defines_8h.html#a7457108f74986ee619be85ad4db5f34b">CONF_LOG_APPENDER_TYPE</a>] = <a class="code" href="defines_8h.html#a9eaccd6729f5adaa6a41e767ea0baffc">CONF_LOG_APPENDER_TYPE_CONSOLE</a>;
                dummy[<a class="code" href="defines_8h.html#a8fe2b1c7bf377d27c7e5656b8154a8d6">CONF_LOG_APPENDER_COLORED</a>] = (bool)<span class="keyword">true</span>;
                dummy[<a class="code" href="defines_8h.html#a8b50b4ee2730cf5bc14ab9378f1090a4">CONF_LOG_APPENDER_LEVEL</a>] = (uint32_t) 6;
                <a class="code" href="classConsoleLogLocation.html">ConsoleLogLocation</a> * pLogLocation = <span class="keyword">new</span> <a class="code" href="classConsoleLogLocation.html">ConsoleLogLocation</a>(dummy);
                pLogLocation-&gt;<a class="code" href="classBaseLogLocation.html#a210a45b1cbe4e34e91049acac641d2ae">SetLevel</a>(<a class="code" href="defines_8h.html#ae270070f57b62a1788401965b236f6b2">_FINEST_</a>);
                <a class="code" href="classLogger.html#a10c51f401b39d5bd82ff20f109c92f7b">Logger::AddLogLocation</a>(pLogLocation);
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Reading configuration from %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;configFile&quot;</span>]));
<span class="preprocessor">#ifdef COMPILE_STATIC</span>
<span class="preprocessor"></span>        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a> = <span class="keyword">new</span> <a class="code" href="classConfigFile.html">ConfigFile</a>(SpawnApplication, SpawnFactory);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a> = <span class="keyword">new</span> <a class="code" href="classConfigFile.html">ConfigFile</a>(NULL, NULL);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordtype">string</span> configFilePath = <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;configFile&quot;</span>];
        <span class="keywordtype">string</span> fileName;
        <span class="keywordtype">string</span> extension;
        splitFileName(configFilePath, fileName, extension);

        <span class="keywordflow">if</span> (lowerCase(extension) == <span class="stringliteral">&quot;xml&quot;</span>) {
                <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#ac2b6e190017f6983bd57668d97ec4d15">LoadXmlFile</a>(configFilePath,
                                (<span class="keywordtype">bool</span>)<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--daemon&quot;</span>])) {
                        <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to load file %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(configFilePath));
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lowerCase(extension) == <span class="stringliteral">&quot;lua&quot;</span>) {
<span class="preprocessor">#ifdef HAS_LUA</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#a59c82d39dcba6c932e8529525d9ec9f4">LoadLuaFile</a>(configFilePath,
                                (<span class="keywordtype">bool</span>)<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--daemon&quot;</span>])) {
                        <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to load file %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(configFilePath));
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>                cout &lt;&lt; <span class="stringliteral">&quot;Lua is not supported by the current build of the server&quot;</span> &lt;&lt; endl;
                <a class="code" href="logging_8h.html#a821326052e3e2bf1fb2d678e9e9a6004">ASSERT</a>(<span class="stringliteral">&quot;Lua is not supported by the current build of the server&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
<span class="preprocessor">#endif </span><span class="comment">/* HAS_LUA */</span>
        } <span class="keywordflow">else</span> {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Invalid file format: %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(configFilePath));
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

<span class="preprocessor">#ifndef WIN32</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#abf894b60971513629086c9255c2e0fe7">IsDaemon</a>()) {
                <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a7cc45120a2d0e892dc039cd038277612">daemon</a>) {
                        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Daemonize...&quot;</span>);
                        pid_t pid = fork();
                        <span class="keywordflow">if</span> (pid &lt; 0) {
                                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to start daemonize. fork() failed&quot;</span>);
                                <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        }

                        <span class="keywordflow">if</span> (pid &gt; 0) {
                                <span class="keywordflow">if</span> (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>].<a class="code" href="classVariant.html#a5f2116f8bc4f7f129a628d124465fdd4">HasKey</a>(<span class="stringliteral">&quot;--pid&quot;</span>))
                                        <a class="code" href="crtmpserver_8cpp.html#a1641a04a6e7e7520ab661fda41f9df30">WritePidFile</a>(pid);
                                <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        }

                        <a class="code" href="logging_8h.html#ad23956c66ba8998d24d95b0a4a9f3f6b">FINEST</a>(<span class="stringliteral">&quot;Create a new SID for the daemon&quot;</span>);
                        pid_t sid = setsid();
                        <span class="keywordflow">if</span> (sid &lt; 0) {
                                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to start daemonize. setsid() failed&quot;</span>);
                                <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        }

                        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a7cc45120a2d0e892dc039cd038277612">daemon</a> = <span class="keyword">true</span>;
                        
                        <a class="code" href="classLogger.html#ad04411541f4cecf596e0df0fbf7c09ca">Logger::SignalFork</a>();
                }
        }
<span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure logger&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#a8af63af37f0961a5a043c0486bd5432d">ConfigLogAppenders</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure log appenders&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Initialize I/O handlers manager: %s&quot;</span>, NETWORK_REACTOR);
        <a class="code" href="crtmpserver_8cpp.html#a248c764067ee60c03ee370784c49f353">IOHandlerManager::Initialize</a>();

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure modules&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#ac6a5b93943ebd51e4929eb330465ce4a">ConfigModules</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure modules&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Plug in the default protocol factory&quot;</span>);
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a5b51914db7d5f184a2c602510cd5dcd1">pProtocolFactory</a> = <span class="keyword">new</span> <a class="code" href="classDefaultProtocolFactory.html">DefaultProtocolFactory</a>();
        <span class="keywordflow">if</span> (!<a class="code" href="classProtocolFactoryManager.html#a55f7f1300803201fde350b4f33c90064" title="Registers the atomic protocols and protocol chains of the factory.">ProtocolFactoryManager::RegisterProtocolFactory</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a5b51914db7d5f184a2c602510cd5dcd1">pProtocolFactory</a>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to register default protocols factory&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure factories&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#a9b907a688e3b44f40dbd91516aa0383b">ConfigFactories</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure factories&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure acceptors&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#ab30f02a1a8a366548305ecc5789047a4">ConfigAcceptors</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure acceptors&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure instances&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#afc9ab8be5352d487800ba66dfa43c913">ConfigInstances</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure instances&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Start I/O handlers manager: %s&quot;</span>, NETWORK_REACTOR);
        IOHandlerManager::Start();

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Configure applications&quot;</span>);
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#a6b0fc1e231f7eafbd1442cda103ff5ca">ConfigApplications</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to configure applications&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;Install the quit signal&quot;</span>);
        installQuitSignal(<a class="code" href="crtmpserver_8cpp.html#a80d68e031b0e7016556e529e1b63fa5e">QuitSignalHandler</a>);

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="crtmpserver.cpp::main" ref="a3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00071">71</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                {
        SRAND();
        InitNetworking();

        <span class="comment">//1. Pick up the startup parameters and hold them inside the running status</span>
        <span class="keywordflow">if</span> (argc &lt; 2) {
                cout &lt;&lt; <span class="stringliteral">&quot;Invalid command line. Use --help&quot;</span> &lt;&lt; endl;
                <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">if</span> (!<a class="code" href="classVariant.html#a8eb5cc5c03059d92fdfdb38d87d58a52">Variant::DeserializeFromCmdLineArgs</a>(argc, argv, <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>)) {
                <a class="code" href="crtmpserver_8cpp.html#ae964ff8411b4fdcaf65cb5529aea4bef">PrintHelp</a>();
                <span class="keywordflow">return</span> -1;
        }
        <span class="keywordtype">string</span> configFile = argv[argc - 1];
        <span class="keywordflow">if</span> (configFile.find(<span class="stringliteral">&quot;--&quot;</span>) == 0)
                configFile = <span class="stringliteral">&quot;&quot;</span>;
        <a class="code" href="crtmpserver_8cpp.html#a47d3f62cf74aef3f51774a4fe59063ae">NormalizeCommandLine</a>(configFile);

        <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--help&quot;</span>]) {
                <a class="code" href="crtmpserver_8cpp.html#ae964ff8411b4fdcaf65cb5529aea4bef">PrintHelp</a>();
                <span class="keywordflow">return</span> 0;
        }

        <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--version&quot;</span>]) {
                <a class="code" href="crtmpserver_8cpp.html#a1fae5968f70747445d63f63065fb7ef3">PrintVersion</a>();
                <span class="keywordflow">return</span> 0;
        }

        <span class="keywordflow">do</span> {
                <span class="comment">//2. Reset the run flag</span>
                <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a684bacc22e882d8df10e1724a584144d">run</a> = <span class="keyword">false</span>;

                <span class="comment">//3. Initialize the running status</span>
                <span class="keywordflow">if</span> (<a class="code" href="crtmpserver_8cpp.html#a248c764067ee60c03ee370784c49f353">Initialize</a>()) {
                        <a class="code" href="crtmpserver_8cpp.html#aa3eca255b6be227d7d901cc2a72017a5">Run</a>();
                } <span class="keywordflow">else</span> {
                        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a684bacc22e882d8df10e1724a584144d">run</a> = <span class="keyword">false</span>;
                }

                <span class="comment">//5. Cleanup</span>
                <a class="code" href="crtmpserver_8cpp.html#ae89a123aad1c66a76c398b7af216aae4">Cleanup</a>();
        } <span class="keywordflow">while</span> (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a684bacc22e882d8df10e1724a584144d">run</a>);

        <span class="comment">//6. We are done</span>
        <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a47d3f62cf74aef3f51774a4fe59063ae"></a><!-- doxytag: member="crtmpserver.cpp::NormalizeCommandLine" ref="a47d3f62cf74aef3f51774a4fe59063ae" args="(string configFile)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NormalizeCommandLine </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>configFile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00328">328</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                             {
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;configFile&quot;</span>] = configFile;
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>].<a class="code" href="classVariant.html#af386938c6a3e292f216a6183c7245f79">RemoveKey</a>(configFile);
        <span class="keywordtype">bool</span> tmp = (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;--help&quot;</span>] != <a class="code" href="variant_8h.html#a1b6fed965fba6725812b67081f5676e3a904b7aa7d50a3f097ee0ce2cc669c300">V_NULL</a>);
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;--help&quot;</span>] = (bool)tmp;
        tmp = (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;--version&quot;</span>] != <a class="code" href="variant_8h.html#a1b6fed965fba6725812b67081f5676e3a904b7aa7d50a3f097ee0ce2cc669c300">V_NULL</a>);
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;--version&quot;</span>] = (bool)tmp;
        tmp = (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--use-implicit-console-appender&quot;</span>] != <a class="code" href="variant_8h.html#a1b6fed965fba6725812b67081f5676e3a904b7aa7d50a3f097ee0ce2cc669c300">V_NULL</a>);
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--use-implicit-console-appender&quot;</span>] = (bool)tmp;
        tmp = (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--daemon&quot;</span>] != <a class="code" href="variant_8h.html#a1b6fed965fba6725812b67081f5676e3a904b7aa7d50a3f097ee0ce2cc669c300">V_NULL</a>);
        <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--daemon&quot;</span>] = (bool)tmp;
        <span class="keywordflow">if</span> (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>].<a class="code" href="classVariant.html#a5f2116f8bc4f7f129a628d124465fdd4">HasKey</a>(<span class="stringliteral">&quot;--uid&quot;</span>)) {
                <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--uid&quot;</span>] = (uint32_t) atoi(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--uid&quot;</span>]));
        } <span class="keywordflow">else</span> {
                <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--uid&quot;</span>] = (uint32_t) 0;
        }
        <span class="keywordflow">if</span> (<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>].<a class="code" href="classVariant.html#a5f2116f8bc4f7f129a628d124465fdd4">HasKey</a>(<span class="stringliteral">&quot;--gid&quot;</span>)) {
                <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--gid&quot;</span>] = (uint32_t) atoi(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--gid&quot;</span>]));
        } <span class="keywordflow">else</span> {
                <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--gid&quot;</span>] = (uint32_t) 0;
        }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae964ff8411b4fdcaf65cb5529aea4bef"></a><!-- doxytag: member="crtmpserver.cpp::PrintHelp" ref="ae964ff8411b4fdcaf65cb5529aea4bef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintHelp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00298">298</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                 {
        cout &lt;&lt; <span class="stringliteral">&quot;Usage: \n&quot;</span> &lt;&lt; (string) <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;program&quot;</span>] &lt;&lt; <span class="stringliteral">&quot; [OPTIONS] [config_file_path]&quot;</span> &lt;&lt; endl &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;OPTIONS:&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --help&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Prints this help and exit\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --version&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Prints the version and exit.\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --use-implicit-console-appender&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Adds a console log appender.&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Particulary useful when the server starts and stops immediatly.&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Allows you to see if something is wrong with the config file\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --daemon&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Overrides the daemon setting inside the config file and forces&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      the server to start in daemon mode.\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --uid=&lt;uid&gt;&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Run the process with the specified user id\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --gid=&lt;gid&gt;&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Run the process with the specified group id\n&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;    --pid=&lt;pid_file&gt;&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Create PID file.&quot;</span> &lt;&lt; endl;
        cout &lt;&lt; <span class="stringliteral">&quot;      Works only if --daemon option is specified\n&quot;</span> &lt;&lt; endl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1fae5968f70747445d63f63065fb7ef3"></a><!-- doxytag: member="crtmpserver.cpp::PrintVersion" ref="a1fae5968f70747445d63f63065fb7ef3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintVersion </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00321">321</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                    {
<span class="preprocessor">#ifndef RTMPSERVER_VERSION</span>
<span class="preprocessor"></span><span class="preprocessor">#define RTMPSERVER_VERSION &quot;(version not available)&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        cout &lt;&lt; <a class="code" href="defines_8h.html#a5ce42145576e79c11ee56ae28fa7e181">HTTP_HEADERS_SERVER_US</a> &lt;&lt; <span class="stringliteral">&quot; version &quot;</span> &lt;&lt; <a class="code" href="crtmpserver_8cpp.html#ae9399b6107bb1108bb8506c78341326d">RTMPSERVER_VERSION</a> &lt;&lt; endl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a80d68e031b0e7016556e529e1b63fa5e"></a><!-- doxytag: member="crtmpserver.cpp::QuitSignalHandler" ref="a80d68e031b0e7016556e529e1b63fa5e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QuitSignalHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00294">294</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                             {
        IOHandlerManager::SignalShutdown();
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa3eca255b6be227d7d901cc2a72017a5"></a><!-- doxytag: member="crtmpserver.cpp::Run" ref="aa3eca255b6be227d7d901cc2a72017a5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00252">252</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">           {
        <span class="keywordflow">if</span> (!<a class="code" href="crtmpserver_8cpp.html#adedd5b79ceb3bb26176b45c97b9653fb">ApplyUIDGID</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to apply user id&quot;</span>);
                exit(-1);
        }
        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;\n%s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a327e1e7607c9df3b248172f17777f740">pConfigFile</a>-&gt;<a class="code" href="classConfigFile.html#adb77430875c77df8f571f9617dffcfa9">GetServicesInfo</a>()));
        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;GO! GO! GO! (%u)&quot;</span>, (uint32_t) getpid());
        <span class="keywordflow">while</span> (IOHandlerManager::Pulse()) {
                IOHandlerManager::DeleteDeadHandlers();
                <a class="code" href="classProtocolManager.html#aaf6c48b424b8f4a43bdee8c8e7fdb6a5" title="This function makes sure that the memory allocated to all dead protocols are deleted.">ProtocolManager::CleanupDeadProtocols</a>();
        }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1641a04a6e7e7520ab661fda41f9df30"></a><!-- doxytag: member="crtmpserver.cpp::WritePidFile" ref="a1641a04a6e7e7520ab661fda41f9df30" args="(pid_t pid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WritePidFile </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>rewrite PID file if it already exists</p>
</p>

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00369">369</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                             {
        <span class="keywordtype">string</span> pidFile = <a class="code" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a>.<a class="code" href="structRunningStatus.html#a9b6f737c605009bcfcfec7daa82fb8a8">commandLine</a>[<span class="stringliteral">&quot;arguments&quot;</span>][<span class="stringliteral">&quot;--pid&quot;</span>];
        <span class="keyword">struct </span>stat sb;
        <span class="keywordflow">if</span> (stat(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(pidFile), &amp;sb) == 0) {
                <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;pid file %s already exists\n&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(pidFile));
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno != ENOENT) {
                <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;stat: %s&quot;</span>, strerror(errno));
                <span class="keywordflow">return</span>;
        }

        <a class="code" href="classFile.html">File</a> f;
        <span class="keywordflow">if</span> (!f.<a class="code" href="classFile.html#a923b40cc3cb6e7283d5588a5805266dd">Initialize</a>(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(pidFile), <a class="code" href="file_8h.html#aa2364c44b077c341b5b4ba3138264411af92f9620c06dbb2e4d82a8aca4838f44">FILE_OPEN_MODE_TRUNCATE</a>)) {
                <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Unable to open PID file %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(pidFile));
                <span class="keywordflow">return</span>;
        }

        <span class="keywordtype">string</span> content = format(<span class="stringliteral">&quot;%&quot;</span>PRIz<span class="stringliteral">&quot;d&quot;</span>, pid);
        <span class="keywordflow">if</span> (!f.<a class="code" href="classFile.html#af7bf1fa6839cc023e6f3ffada1450494">WriteString</a>(content)) {
                <a class="code" href="logging_8h.html#a8f75b971030a39ef811d3526a62b36b8">WARN</a>(<span class="stringliteral">&quot;Unable to write PID to file %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(pidFile));
                <span class="keywordflow">return</span>;
        }
        f.<a class="code" href="classFile.html#a7ce241fcabbbbed256d1d2beb5de300f">Close</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="acaba55159f1dc8381e0adc2b2eb6b64f"></a><!-- doxytag: member="crtmpserver.cpp::gRs" ref="acaba55159f1dc8381e0adc2b2eb6b64f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRunningStatus.html">RunningStatus</a> <a class="el" href="crtmpserver_8cpp.html#acaba55159f1dc8381e0adc2b2eb6b64f">gRs</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="crtmpserver_8cpp_source.html#l00064">64</a> of file <a class="el" href="crtmpserver_8cpp_source.html">crtmpserver.cpp</a>.</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Oct 19 2011 15:53:36 for crtmpserver by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
