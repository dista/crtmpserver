<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>crtmpserver: BaseMediaDocument Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">crtmpserver</div>
   <div id="projectbrief">AmediaserverforAdobe®Flash®,Apple®iOSdevicesandblahblah.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a>  </div>
  <div class="headertitle">
<h1>BaseMediaDocument Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="BaseMediaDocument" -->
<p><code>#include &lt;<a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>&gt;</code></p>

<p><a href="classBaseMediaDocument-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a0bb9b4bec61a1516bd850d79e1f5e2e9">BaseMediaDocument</a> (<a class="el" href="classVariant.html">Variant</a> &amp;metadata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#aa2b6a28f026ec411d24532b8fc9c0668">~BaseMediaDocument</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a84e29fc8bf9c94506042e4171bcb8157">Process</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This functions do things like opening the media file, building frames, saving the meta, etc.  <a href="#a84e29fc8bf9c94506042e4171bcb8157"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classVariant.html">Variant</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a5cc423c86000e05682400ea97dc6d289">GetMetadata</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the meta data.  <a href="#a5cc423c86000e05682400ea97dc6d289"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">MediaFile &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#ae92891242c9e6f55ebc506cdc90760c6">GetMediaFile</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the media file.  <a href="#ae92891242c9e6f55ebc506cdc90760c6"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a35ee37fc8f204b3b0a0e8f6dcf8412c1">ParseDocument</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a746495701d21e450e8c33df9535c03e5">BuildFrames</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classVariant.html">Variant</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a003dc785a3ee2dd90f877215aff1d394">GetRTMPMeta</a> ()=0</td></tr>
<tr><td colspan="2"><h2><a name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#ad3aa0e570342331959541440af0edda3">CompareFrames</a> (const <a class="el" href="struct__MediaFrame.html">MediaFrame</a> &amp;frame1, const <a class="el" href="struct__MediaFrame.html">MediaFrame</a> &amp;frame2)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">MediaFile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="struct__MediaFrame.html">MediaFrame</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a0dec7b4021fcd7213621b3624046499c">_audioSamplesCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#adda4dffbf39d08ff67a1e853e8e75e76">_videoSamplesCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classVariant.html">Variant</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">_keyframeSeek</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#ab3a2b3ff96f6c570fbc94c02f29aba0b">_seekGranularity</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStreamCapabilities.html">StreamCapabilities</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#ac74d811ab324e47d67b26ab98ce8db83">SaveSeekFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBaseMediaDocument.html#ab2e7955d480c9ff965ebe12be403cc54">SaveMetaFile</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00029">29</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a0bb9b4bec61a1516bd850d79e1f5e2e9"></a><!-- doxytag: member="BaseMediaDocument::BaseMediaDocument" ref="a0bb9b4bec61a1516bd850d79e1f5e2e9" args="(Variant &amp;metadata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseMediaDocument::BaseMediaDocument </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classVariant.html">Variant</a> &amp;&#160;</td>
          <td class="paramname"><em>metadata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00022">22</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                      {
        <a class="code" href="classBaseMediaDocument.html#a0dec7b4021fcd7213621b3624046499c">_audioSamplesCount</a> = 0;
        <a class="code" href="classBaseMediaDocument.html#adda4dffbf39d08ff67a1e853e8e75e76">_videoSamplesCount</a> = 0;
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a> = metadata;
        <a class="code" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">_keyframeSeek</a> = <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa2b6a28f026ec411d24532b8fc9c0668"></a><!-- doxytag: member="BaseMediaDocument::~BaseMediaDocument" ref="aa2b6a28f026ec411d24532b8fc9c0668" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseMediaDocument::~BaseMediaDocument </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00029">29</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a746495701d21e450e8c33df9535c03e5"></a><!-- doxytag: member="BaseMediaDocument::BuildFrames" ref="a746495701d21e450e8c33df9535c03e5" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool BaseMediaDocument::BuildFrames </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad3aa0e570342331959541440af0edda3"></a><!-- doxytag: member="BaseMediaDocument::CompareFrames" ref="ad3aa0e570342331959541440af0edda3" args="(const MediaFrame &amp;frame1, const MediaFrame &amp;frame2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BaseMediaDocument::CompareFrames </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct__MediaFrame.html">MediaFrame</a> &amp;&#160;</td>
          <td class="paramname"><em>frame1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct__MediaFrame.html">MediaFrame</a> &amp;&#160;</td>
          <td class="paramname"><em>frame2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00116">116</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                        {
        <span class="keywordflow">if</span> (frame1.<a class="code" href="struct__MediaFrame.html#a639c705b4ecaab65e3c6207b3c6eb501">absoluteTime</a> == frame2.<a class="code" href="struct__MediaFrame.html#a639c705b4ecaab65e3c6207b3c6eb501">absoluteTime</a>)
                <span class="keywordflow">return</span> frame1.<a class="code" href="struct__MediaFrame.html#aa1e8ccbd8f8ccc209b633e21f002f3e8">start</a> &lt; frame2.<a class="code" href="struct__MediaFrame.html#aa1e8ccbd8f8ccc209b633e21f002f3e8">start</a>;
        <span class="keywordflow">return</span> frame1.<a class="code" href="struct__MediaFrame.html#a639c705b4ecaab65e3c6207b3c6eb501">absoluteTime</a> &lt; frame2.<a class="code" href="struct__MediaFrame.html#a639c705b4ecaab65e3c6207b3c6eb501">absoluteTime</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae92891242c9e6f55ebc506cdc90760c6"></a><!-- doxytag: member="BaseMediaDocument::GetMediaFile" ref="ae92891242c9e6f55ebc506cdc90760c6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MediaFile &amp; BaseMediaDocument::GetMediaFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the media file. </p>

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00112">112</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                           {
        <span class="keywordflow">return</span> <a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5cc423c86000e05682400ea97dc6d289"></a><!-- doxytag: member="BaseMediaDocument::GetMetadata" ref="a5cc423c86000e05682400ea97dc6d289" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVariant.html">Variant</a> BaseMediaDocument::GetMetadata </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the meta data. </p>

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00108">108</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                       {
        <span class="keywordflow">return</span> <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a003dc785a3ee2dd90f877215aff1d394"></a><!-- doxytag: member="BaseMediaDocument::GetRTMPMeta" ref="a003dc785a3ee2dd90f877215aff1d394" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classVariant.html">Variant</a> BaseMediaDocument::GetRTMPMeta </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a35ee37fc8f204b3b0a0e8f6dcf8412c1"></a><!-- doxytag: member="BaseMediaDocument::ParseDocument" ref="a35ee37fc8f204b3b0a0e8f6dcf8412c1" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool BaseMediaDocument::ParseDocument </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a84e29fc8bf9c94506042e4171bcb8157"></a><!-- doxytag: member="BaseMediaDocument::Process" ref="a84e29fc8bf9c94506042e4171bcb8157" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BaseMediaDocument::Process </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This functions do things like opening the media file, building frames, saving the meta, etc. </p>

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00032">32</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                {
        <span class="keywordtype">double</span> startTime = 0;
        <span class="keywordtype">double</span> endTime = 0;
        GETCLOCKS(startTime);

        <span class="comment">//1. Compute the names</span>
        <a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a> = (string) <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a0091f80a5a40d2fa3d20fc2dc5387f1e">META_SERVER_FULL_PATH</a>];
        <a class="code" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a> = <a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a> + <span class="stringliteral">&quot;.&quot;</span><a class="code" href="defines_8h.html#ac14efbc76596ada754d1a60d16e37d76">MEDIA_TYPE_META</a>;
        <a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a> = <a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a> + <span class="stringliteral">&quot;.&quot;</span><a class="code" href="defines_8h.html#a0cae8103483b0184a975dd49ae3ea237">MEDIA_TYPE_SEEK</a>;
        <a class="code" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">_keyframeSeek</a> = (bool)<a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a21e3a66019ea8bd016be2aa68c58fb13">CONF_APPLICATION_KEYFRAMESEEK</a>];
        <a class="code" href="classBaseMediaDocument.html#ab3a2b3ff96f6c570fbc94c02f29aba0b">_seekGranularity</a> = (uint32_t) <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a5b29498b7455e40d370ac019b85cd589">CONF_APPLICATION_SEEKGRANULARITY</a>];

        <span class="comment">//1. Open the media file</span>
<span class="preprocessor">#ifdef HAS_MMAP</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>.Initialize(<a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a>, 4 * 1024 * 1024, <span class="keyword">true</span>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to open media file: %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a>));
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>.Initialize(<a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to open media file: %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">_mediaFilePath</a>));
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <span class="comment">//4. Read the document</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#a35ee37fc8f204b3b0a0e8f6dcf8412c1">ParseDocument</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to parse document&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//5. Build the frames</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#a746495701d21e450e8c33df9535c03e5">BuildFrames</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to build frames&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//6. Save the seek file</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#ac74d811ab324e47d67b26ab98ce8db83">SaveSeekFile</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to save seeking file&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//7. Build the meta</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#ab2e7955d480c9ff965ebe12be403cc54">SaveMetaFile</a>()) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to save meta file&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        GETCLOCKS(endTime);

        <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;%&quot;</span>PRIz<span class="stringliteral">&quot;u frames computed in %.2f seconds at a speed of %.2f FPS&quot;</span>,
                        <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size(),
                        (endTime - startTime) / (<span class="keywordtype">double</span>) CLOCKS_PER_SECOND,
                        (double) <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() / ((endTime - startTime) / (<span class="keywordtype">double</span>) CLOCKS_PER_SECOND));
        <span class="keywordflow">if</span> (<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() != 0) {
                uint32_t totalSeconds = (uint32_t) (((uint32_t) <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() - 1].absoluteTime) / 1000);
                uint32_t hours = totalSeconds / 3600;
                uint32_t minutes = (totalSeconds - hours * 3600) / 60;
                uint32_t seconds = (totalSeconds - hours * 3600 - minutes * 60);
                <a class="code" href="logging_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>(<span class="stringliteral">&quot;File size: %&quot;</span>PRIu64<span class="stringliteral">&quot; bytes; Duration: %u:%u:%u (%u sec); Optimal bandwidth: %.2f kb/s&quot;</span>,
                                <a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>.Size(),
                                hours, minutes, seconds,
                                totalSeconds,
                                (double) <a class="code" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a>.<a class="code" href="classStreamCapabilities.html#a8ed589876da8e1f6b965495bf965f156">bandwidthHint</a>);
        }

        moveFile(<a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a> + <span class="stringliteral">&quot;.tmp&quot;</span>, <a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a>);
        moveFile(<a class="code" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a> + <span class="stringliteral">&quot;.tmp&quot;</span>, <a class="code" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a>);

        chmod(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a>), S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP);
        chmod(<a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a>), S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP);

        <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab2e7955d480c9ff965ebe12be403cc54"></a><!-- doxytag: member="BaseMediaDocument::SaveMetaFile" ref="ab2e7955d480c9ff965ebe12be403cc54" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BaseMediaDocument::SaveMetaFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00230">230</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                     {
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#ad87ea774aec2e1f3afeeaa898197537b">META_AUDIO_FRAMES_COUNT</a>] = <a class="code" href="classBaseMediaDocument.html#a0dec7b4021fcd7213621b3624046499c">_audioSamplesCount</a>;
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a76a9d144cadd378f1c9f487db0e9927e">META_VIDEO_FRAMES_COUNT</a>] = <a class="code" href="classBaseMediaDocument.html#adda4dffbf39d08ff67a1e853e8e75e76">_videoSamplesCount</a>;
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a118d2eb859b1b81dd27cf241c4b561b3">META_TOTAL_FRAMES_COUNT</a>] = (uint32_t) <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size();

        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a53099ae9f556549e015053378864e39b">META_FILE_SIZE</a>] = (uint64_t) <a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>.Size();
        <span class="keywordflow">if</span> (<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() &gt; 0) {
                <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a57c44c8556826dcf301939452ebabe8b">META_FILE_DURATION</a>] = (uint32_t) <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() - 1].absoluteTime;
                <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a86d5f281d3ed3d11feb86e1e8d9ae332">META_FILE_BANDWIDTH</a>] = <a class="code" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a>.<a class="code" href="classStreamCapabilities.html#a8ed589876da8e1f6b965495bf965f156">bandwidthHint</a>;
        } <span class="keywordflow">else</span> {
                <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a57c44c8556826dcf301939452ebabe8b">META_FILE_DURATION</a>] = (uint32_t) 0;
        }

        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#ab9541a2005f8fb6337bd36a63b3189da">META_RTMP_META</a>] = <a class="code" href="classBaseMediaDocument.html#a003dc785a3ee2dd90f877215aff1d394">GetRTMPMeta</a>();
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#ab9541a2005f8fb6337bd36a63b3189da">META_RTMP_META</a>][<span class="stringliteral">&quot;duration&quot;</span>] = (double) <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#a57c44c8556826dcf301939452ebabe8b">META_FILE_DURATION</a>] / 1000.00;
        <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>[<a class="code" href="defines_8h.html#ab9541a2005f8fb6337bd36a63b3189da">META_RTMP_META</a>][<a class="code" href="defines_8h.html#a86d5f281d3ed3d11feb86e1e8d9ae332">META_FILE_BANDWIDTH</a>] = <a class="code" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a>.<a class="code" href="classStreamCapabilities.html#a8ed589876da8e1f6b965495bf965f156">bandwidthHint</a>;

        <span class="keywordflow">return</span> <a class="code" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">_metadata</a>.<a class="code" href="classVariant.html#ad1c0ba213f4f1f3bf2c6a0ff34508769">SerializeToBinFile</a>(<a class="code" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">_metaFilePath</a> + <span class="stringliteral">&quot;.tmp&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac74d811ab324e47d67b26ab98ce8db83"></a><!-- doxytag: member="BaseMediaDocument::SaveSeekFile" ref="ac74d811ab324e47d67b26ab98ce8db83" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BaseMediaDocument::SaveSeekFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8cpp_source.html#l00122">122</a> of file <a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                     {
        <span class="keywordflow">if</span> (<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() &lt;= 2) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;No frames found&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <a class="code" href="classFile.html">File</a> seekFile;

        <span class="comment">//1. Open the file</span>
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a923b40cc3cb6e7283d5588a5805266dd">Initialize</a>(<a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a> + <span class="stringliteral">&quot;.tmp&quot;</span>, <a class="code" href="file_8h.html#aa2364c44b077c341b5b4ba3138264411af92f9620c06dbb2e4d82a8aca4838f44">FILE_OPEN_MODE_TRUNCATE</a>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to open seeking file %s&quot;</span>, <a class="code" href="baseplatform_8h.html#a18d295a837ac71add5578860b55e5502">STR</a>(<a class="code" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">_seekFilePath</a>));
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//2. Setup the bandwidth hint in bytes/second</span>
        uint32_t totalSeconds = (uint32_t) (((uint32_t) <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size() - 1].absoluteTime) / 1000);
        <a class="code" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a>.<a class="code" href="classStreamCapabilities.html#a8ed589876da8e1f6b965495bf965f156">bandwidthHint</a> =
                        (uint32_t) ((<span class="keywordtype">double</span>) <a class="code" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">_mediaFile</a>.Size() / (double) totalSeconds / 1024.0 * 8.0);

        <span class="comment">//2. Serialize the stream capabilities</span>
        <a class="code" href="classIOBuffer.html" title="Base class which contains all the necessary functions involving input/output buffering.">IOBuffer</a> raw;
        <span class="keywordflow">if</span> (!<a class="code" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">_streamCapabilities</a>.<a class="code" href="classStreamCapabilities.html#aada8a753a7de44115327dc4b47b7b0b2">Serialize</a>(raw)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to serialize stream capabilities&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a2d0106342217515ecf5426675f71c236">WriteUI32</a>(<a class="code" href="iobuffer_8h.html#a23d30f9ed61d45104297ac1288875dd5">GETAVAILABLEBYTESCOUNT</a>(raw), <span class="keyword">false</span>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to serialize stream capabilities&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a858d87b1460b63a07ede8c83b1aede41">WriteBuffer</a>(<a class="code" href="iobuffer_8h.html#aed6fd97222265185cb7d8fce70eaccd4">GETIBPOINTER</a>(raw), <a class="code" href="iobuffer_8h.html#a23d30f9ed61d45104297ac1288875dd5">GETAVAILABLEBYTESCOUNT</a>(raw))) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to serialize stream capabilities&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//2. Write the number of frames</span>
        uint32_t framesCount = <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>.size();
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a2d0106342217515ecf5426675f71c236">WriteUI32</a>(framesCount, <span class="keyword">false</span>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to write frame count&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//3. Write the frames</span>
        <span class="keywordtype">bool</span> hasVideo = <span class="keyword">false</span>;
        uint64_t maxFrameSize = 0;

        <a class="code" href="baseplatform_8h.html#a591428e01846b9c77f30c99668bf9663">FOR_VECTOR</a>(<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>, i) {
                <a class="code" href="struct__MediaFrame.html">MediaFrame</a> frame = <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[i];
                <span class="keywordflow">if</span> (maxFrameSize &lt; frame.<a class="code" href="struct__MediaFrame.html#a1c6272a2efd15aba84ce34bc81166a21">length</a>) {
                        <span class="comment">//WARN(&quot;maxFrameSize bumped up: %&quot;PRIu64&quot; -&gt; %&quot;PRIu64, maxFrameSize, frame.length);</span>
                        maxFrameSize = frame.<a class="code" href="struct__MediaFrame.html#a1c6272a2efd15aba84ce34bc81166a21">length</a>;
                }
                hasVideo |= (frame.<a class="code" href="struct__MediaFrame.html#a1d525ce828c1b678c8be3316faea3f7a">type</a> == <a class="code" href="mediaframe_8h.html#a7aa788efcacc88def6bb47cc9d495ec4">MEDIAFRAME_TYPE_VIDEO</a>);
                <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a858d87b1460b63a07ede8c83b1aede41">WriteBuffer</a>((uint8_t *) &amp; frame, sizeof (frame))) {
                        <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to write frame&quot;</span>);
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
        }
        <a class="code" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">_keyframeSeek</a> &amp;= hasVideo;

        <span class="comment">//4. Write the seek granularity</span>
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a2d0106342217515ecf5426675f71c236">WriteUI32</a>(<a class="code" href="classBaseMediaDocument.html#ab3a2b3ff96f6c570fbc94c02f29aba0b">_seekGranularity</a>, <span class="keyword">false</span>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to write sampling rate&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//4. create the time to frame index table. First, see what is the total time</span>
        <span class="keywordtype">double</span> totalTime = 0;

        <span class="keywordflow">if</span> (framesCount &gt;= 1) {
                totalTime = <a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[framesCount - 1].absoluteTime;

                <span class="comment">//5. build the table</span>
                uint32_t frameIndex = 0;
                uint32_t seekPoint = 0;
                <span class="keywordflow">for</span> (<span class="keywordtype">double</span> i = 0; i &lt;= totalTime; i += <a class="code" href="classBaseMediaDocument.html#ab3a2b3ff96f6c570fbc94c02f29aba0b">_seekGranularity</a>) {
                        <span class="keywordflow">while</span> (<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[frameIndex].absoluteTime &lt; i) {
                                frameIndex++;
                                <span class="keywordflow">if</span> (frameIndex &gt;= framesCount)
                                        <span class="keywordflow">break</span>;

                                <span class="keywordflow">if</span> (<a class="code" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">_keyframeSeek</a>) {
                                        <span class="keywordflow">if</span> ((<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[frameIndex].type == <a class="code" href="mediaframe_8h.html#a7aa788efcacc88def6bb47cc9d495ec4">MEDIAFRAME_TYPE_VIDEO</a>)
                                                        &amp;&amp; (<a class="code" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">_frames</a>[frameIndex].isKeyFrame)) {
                                                seekPoint = frameIndex;
                                        }
                                } <span class="keywordflow">else</span> {
                                        seekPoint = frameIndex;
                                }
                        }
                        <span class="keywordflow">if</span> (frameIndex &gt;= framesCount)
                                <span class="keywordflow">break</span>;
                        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a2d0106342217515ecf5426675f71c236">WriteUI32</a>(seekPoint, <span class="keyword">false</span>)) {
                                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to write frame index&quot;</span>);
                                <span class="keywordflow">return</span> <span class="keyword">false</span>;
                        }
                }
        }

        <span class="comment">//6. Save the max frame size</span>
        <span class="keywordflow">if</span> (!seekFile.<a class="code" href="classFile.html#a797987417369d704a75b3ba68f6eb3e2">WriteUI64</a>(maxFrameSize, <span class="keyword">false</span>)) {
                <a class="code" href="logging_8h.html#a0d093cb749cfc7ab5993726392df681f">FATAL</a>(<span class="stringliteral">&quot;Unable to write frame count&quot;</span>);
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//7. Done</span>
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a0dec7b4021fcd7213621b3624046499c"></a><!-- doxytag: member="BaseMediaDocument::_audioSamplesCount" ref="a0dec7b4021fcd7213621b3624046499c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBaseMediaDocument.html#a0dec7b4021fcd7213621b3624046499c">BaseMediaDocument::_audioSamplesCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00033">33</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="aee4aafdcc0a87741394a9019b9ad5660"></a><!-- doxytag: member="BaseMediaDocument::_frames" ref="aee4aafdcc0a87741394a9019b9ad5660" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="struct__MediaFrame.html">MediaFrame</a>&gt; <a class="el" href="classBaseMediaDocument.html#aee4aafdcc0a87741394a9019b9ad5660">BaseMediaDocument::_frames</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00032">32</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a22b8d69e7fb1194fd937f1fd0ea65a40"></a><!-- doxytag: member="BaseMediaDocument::_keyframeSeek" ref="a22b8d69e7fb1194fd937f1fd0ea65a40" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classBaseMediaDocument.html#a22b8d69e7fb1194fd937f1fd0ea65a40">BaseMediaDocument::_keyframeSeek</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00039">39</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a23596e6cec954d2fe93ceee59ab79019"></a><!-- doxytag: member="BaseMediaDocument::_mediaFile" ref="a23596e6cec954d2fe93ceee59ab79019" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MediaFile <a class="el" href="classBaseMediaDocument.html#a23596e6cec954d2fe93ceee59ab79019">BaseMediaDocument::_mediaFile</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00031">31</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3e1ee95bdc9a05462daf73a9763a4b14"></a><!-- doxytag: member="BaseMediaDocument::_mediaFilePath" ref="a3e1ee95bdc9a05462daf73a9763a4b14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string <a class="el" href="classBaseMediaDocument.html#a3e1ee95bdc9a05462daf73a9763a4b14">BaseMediaDocument::_mediaFilePath</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00036">36</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a32579e3d49063fa3d5e297192d0e4f6f"></a><!-- doxytag: member="BaseMediaDocument::_metadata" ref="a32579e3d49063fa3d5e297192d0e4f6f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVariant.html">Variant</a> <a class="el" href="classBaseMediaDocument.html#a32579e3d49063fa3d5e297192d0e4f6f">BaseMediaDocument::_metadata</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00035">35</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="afcf30086854780a5c12dd1d277b6bf45"></a><!-- doxytag: member="BaseMediaDocument::_metaFilePath" ref="afcf30086854780a5c12dd1d277b6bf45" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string <a class="el" href="classBaseMediaDocument.html#afcf30086854780a5c12dd1d277b6bf45">BaseMediaDocument::_metaFilePath</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00038">38</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2f8125888724ae00dbb03b74ce77d07e"></a><!-- doxytag: member="BaseMediaDocument::_seekFilePath" ref="a2f8125888724ae00dbb03b74ce77d07e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string <a class="el" href="classBaseMediaDocument.html#a2f8125888724ae00dbb03b74ce77d07e">BaseMediaDocument::_seekFilePath</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00037">37</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab3a2b3ff96f6c570fbc94c02f29aba0b"></a><!-- doxytag: member="BaseMediaDocument::_seekGranularity" ref="ab3a2b3ff96f6c570fbc94c02f29aba0b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBaseMediaDocument.html#ab3a2b3ff96f6c570fbc94c02f29aba0b">BaseMediaDocument::_seekGranularity</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00040">40</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1a6d024d9704bda75e407b2d835e5d64"></a><!-- doxytag: member="BaseMediaDocument::_streamCapabilities" ref="a1a6d024d9704bda75e407b2d835e5d64" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStreamCapabilities.html">StreamCapabilities</a> <a class="el" href="classBaseMediaDocument.html#a1a6d024d9704bda75e407b2d835e5d64">BaseMediaDocument::_streamCapabilities</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00041">41</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<a class="anchor" id="adda4dffbf39d08ff67a1e853e8e75e76"></a><!-- doxytag: member="BaseMediaDocument::_videoSamplesCount" ref="adda4dffbf39d08ff67a1e853e8e75e76" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBaseMediaDocument.html#adda4dffbf39d08ff67a1e853e8e75e76">BaseMediaDocument::_videoSamplesCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="basemediadocument_8h_source.html#l00034">34</a> of file <a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>branches/1.0/sources/thelib/include/mediaformats/<a class="el" href="basemediadocument_8h_source.html">basemediadocument.h</a></li>
<li>branches/1.0/sources/thelib/src/mediaformats/<a class="el" href="basemediadocument_8cpp_source.html">basemediadocument.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Oct 19 2011 15:53:37 for crtmpserver by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
